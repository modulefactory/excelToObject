<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE mapper 
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="iceberg.capi.shop.webdb.repository.PlanPrdSqlMapRepository">
	
	<resultMap type="iceberg.capi.shop.model.PlanPrd" id="planPrdMap">
		<result property = "tmpexbNo"    				column = "TMPEXB_NO"  />                                  
		<result property = "tmpexbTitle"          		column = "TMPEXB_TITLE"   />
		<result property = "rcmdTmpexbExposFlg"   column = "RCMD_TMPEXB_EXPOS_FLG"  />                                  
		<result property = "tmpexbStrDt"          	    column = "TMPEXB_STR_DT"   />	 
		<result property = "tmpexbEndDt"          	    column = "TMPEXB_END_DT"   />
		<result property = "bannerT"          	    column = "BANNER_T"   />
		<result property = "bannerS"          	    column = "BANNER_S"   />
		<result property = "bannerM"          	    column = "BANNER_M"   />
		<result property = "bannerH"          	    column = "BANNER_H"   />
		<result property = "bannerL"          	    column = "BANNER_L"   />
			 
	</resultMap>
	
	<select id="findPlanPrds" parameterType="long" resultMap="planPrdMap">
		<!-- 
		DBMS : WEBDB
		분야 : 단품  findPlanPrdList
		API  : 추천 기획전 목록 조회
		설명 : 상품 코드 기준 추천 기획전 목록 조회
		
		#{prdCd} = 11415738
		-->	
		SELECT DISTINCT
	             LP.PLAN_SEQ AS TMPEXB_NO
	            , LP.TITLE AS TMPEXB_TITLE
	            , LP.RELATION_YN AS RCMD_TMPEXB_EXPOS_FLG
	            , LP.BANNER_T AS BANNER_T
	            , LP.BANNER_S AS BANNER_S
	            , LP.BANNER_M AS BANNER_M
	            , LP.BANNER_H AS BANNER_H
	            , LP.BANNER_L AS BANNER_L
	            , TO_CHAR(LP.ST_DATE,'YYYYMMDD') AS TMPEXB_STR_DT
	            , TO_CHAR(LP.EN_DATE,'YYYYMMDD') AS TMPEXB_END_DT
		FROM LGEC_PLANPRD LP
		        ,(SELECT DISTINCT TMPEXB_SHOP_NO
	           	  FROM   GS_SHOP_TMPEXB
	              WHERE  PRD_CD = #{prdCd}) X
		WHERE LP.PLAN_SEQ = X.TMPEXB_SHOP_NO
		    AND LP.BANNER_S IS NOT NULL
		ORDER BY TMPEXB_STR_DT DESC
	</select>
	
</mapper>