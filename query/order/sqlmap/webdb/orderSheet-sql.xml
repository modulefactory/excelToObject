<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="iceberg.capi.order.webdb.repository.ordersheet.OrderSheetSqlMapRepository">
	               
	<!-- 
		내용	: (주문전) 주문 마스터 정보 조회
		작성자	: 윤병찬
		작성일	: 2013.1.29 신규작성
		
		#{_c.ecOrdNo[0].value} = 280;
		#{_c.ecCustNo[0].value} = 81373658;

	-->
	<resultMap id="gsOrdMMap" type="iceberg.capi.order.model.ordersheet.GsOrdM">
		<result property="basktNo" column="BASKT_NO"/>
		<result property="cashRcptGbnCd" column="CASH_RCPT_GBN_CD"/>
		<result property="cashRcptIdenNoEcp" column="CASH_RCPT_IDEN_NO_ECP"/>
		<result property="cashRcptReqFlg" column="CASH_RCPT_REQ_FLG"/>
		<result property="chanlCd" column="CHANL_CD"/>
		<result property="chanlDtlCd" column="CHANL_DTL_CD"/>
		<result property="custClsCd" column="CUST_CLS_CD"/>
		<result property="custNo" column="CUST_NO"/>
		<result property="dlvcImposeAmt" column="DLVC_IMPOSE_AMT"/>
		<result property="dlvcImposeFlg" column="DLVC_IMPOSE_FLG"/>
		<result property="dlvcStdAmt" column="DLVC_STD_AMT"/>
		<result property="ecCustNo" column="EC_CUST_NO"/>
		<result property="ecDpoCnfSmsSndFlg" column="EC_DPO_CNF_SMS_SND_FLG"/>
		<result property="ecNomemOrdFlg" column="EC_NOMEM_ORD_FLG"/>
		<result property="ecOrdNo" column="EC_ORD_NO"/>
		<result property="ecOrdStCd" column="EC_ORD_ST_CD"/>
		<result property="empOrdDcRt" column="EMP_ORD_DC_RT"/>
		<result property="empOrdTypCd" column="EMP_ORD_TYP_CD"/>
		<result property="fstOrdAmtTot" column="FST_ORD_AMT_TOT"/>
		<result property="fstUseAccAmt" column="FST_USE_ACC_AMT"/>
		<result property="gsnpntMemshpAdmStCd" column="GSNPNT_MEMSHP_ADM_ST_CD"/>
		<result property="ordModDtm" column="ORD_MOD_DTM"/>
		<result property="ordModrId" column="ORD_MODR_ID"/>
		<result property="ordDtm" column="ORD_DTM"/>
		<result property="ordNo" column="ORD_NO"/>
		<result property="ordReqPathNm" column="ORD_REQ_PATH_NM"/>
		<result property="ordTypCd" column="ORD_TYP_CD"/>
		<result property="ordshtPrdTypCd" column="ORDSHT_PRD_TYP_CD"/>
		<result property="ordshtTypCd" column="ORDSHT_TYP_CD"/>
		<result property="orgOrdNo" column="ORG_ORD_NO"/>
		<result property="preCalcPayTypCd" column="PRE_CALC_PAY_TYP_CD"/>
		<result property="ordRegDtm" column="ORD_REG_DTM"/>
		<result property="ordRegrId" column="ORD_REGR_ID"/>
		<result property="repPayMeanCd" column="REP_PAY_MEAN_CD"/>
		<result property="wasInstncNm" column="WAS_INSTNC_NM"/>
		<result property="custRegrIp" column="CUST_REGR_IP"/>
	</resultMap>
	<select id="findGsOrdM" parameterType="criteria"  resultMap="gsOrdMMap">
		SELECT EC_ORD_NO AS EC_ORD_NO	
		      ,REG_DTM AS ORD_REG_DTM	
		      ,REGR_ID AS ORD_REGR_ID	
		      ,MOD_DTM AS ORD_MOD_DTM	
		      ,MODR_ID AS ORD_MODR_ID	
		      ,ORD_DTM AS ORD_DTM	
		      ,ORD_NO AS ORD_NO	
		      ,ORG_ORD_NO AS ORG_ORD_NO	
		      ,CHANL_CD AS CHANL_CD	
		      ,CHANL_DTL_CD AS CHANL_DTL_CD	
		      ,EC_ORD_ST_CD AS EC_ORD_ST_CD	
		      ,BASKT_NO AS BASKT_NO	
		      ,CUST_NO AS CUST_NO	
		      ,EC_CUST_NO AS EC_CUST_NO	
		      ,CUST_CLS_CD AS CUST_CLS_CD	
		      ,EC_NOMEM_ORD_YN AS EC_NOMEM_ORD_FLG	
		      ,ORD_TYP_CD AS ORD_TYP_CD	
		      ,ORDSHT_TYP_CD AS ORDSHT_TYP_CD	
		      ,ORDSHT_PRD_TYP_CD AS ORDSHT_PRD_TYP_CD	
		      ,PRE_CALC_PAY_TYP_CD AS PRE_CALC_PAY_TYP_CD	
		      ,REP_PAY_MEAN_CD AS REP_PAY_MEAN_CD	
		      ,EC_DPO_CNF_SMS_SND_YN AS EC_DPO_CNF_SMS_SND_FLG	
		      ,DLVC_IMPOSE_YN AS DLVC_IMPOSE_FLG	
		      ,DLVC_IMPOSE_AMT AS DLVC_IMPOSE_AMT	
		      ,DLVC_STD_AMT AS DLVC_STD_AMT	
		      ,FMLY_ORD_DC_RT AS EMP_ORD_DC_RT	
		      ,FMLY_ORD_TYP_CD AS EMP_ORD_TYP_CD	
		      ,FST_ORD_AMT_TOT AS FST_ORD_AMT_TOT	
		      ,FST_USE_ACC_AMT AS FST_USE_ACC_AMT	
		      ,GSNPNT_MEMSHP_ADM_ST_CD AS GSNPNT_MEMSHP_ADM_ST_CD	
		      ,CASH_RCPT_REQ_YN AS CASH_RCPT_REQ_FLG	
		      ,CASH_RCPT_GBN_CD AS CASH_RCPT_GBN_CD	
		      ,CASH_RCPT_IDEN_NO_ECP AS CASH_RCPT_IDEN_NO_ECP	
		      ,ORD_PATH_NM AS ORD_REQ_PATH_NM	
		      ,USER_IP AS CUST_REGR_IP	
		      ,SVR_NM AS WAS_INSTNC_NM	
		  FROM GS_ORD_M
		 WHERE EC_ORD_NO = #{_c.ecOrdNo[0].value}
		   AND EC_CUST_NO = #{_c.ecCustNo[0].value}
	</select>
	
	
	<!-- 
		내용	: (주문서) 본품 아이템 조회
		작성자	: 윤병찬
		작성일	: 2013.10.29 신규작성
		
		#{_c.chanlCd[0].value} = 'P';
		#{_c.ecOrdNo[0].value} = 223;
		#{_c.ecCustNo[0].value} = 81373658;
		
	-->
	<resultMap id="ordShtOrgPrdItemList" type="iceberg.capi.order.model.ordersheet.GsOrdItemDExt">
		<result property="arfnTimeCd" column="ARFN_TIME_CD"/>
		<result property="charCpnGbnVal" column="CHAR_CPN_GBN_VAL"/>
		<result property="charCpnTypVal" column="CHAR_CPN_TYP_VAL"/>
		<result property="attrPrdCd" column="ATTR_PRD_CD"/>
		<result property="attrPrdRepCd" column="ATTR_PRD_REP_CD"/>
		<result property="prdAttrColor" column="PRD_ATTR_COLOR"/>
		<result property="prdAttrSize" column="PRD_ATTR_SIZE"/>
		<result property="prdAttrStyle" column="PRD_ATTR_STYLE"/>
		<result property="prdAttrGft" column="PRD_ATTR_GFT"/>
		<result property="basktGbnVal" column="BASKT_GBN_VAL"/>
		<result property="basktItemId" column="BASKT_ITEM_ID"/>
		<result property="broadPreOrdBroadId" column="BROAD_PRE_ORD_BROAD_ID"/>
		<result property="broadPreOrdPathNm" column="BROAD_PRE_ORD_PATH_NM"/>
		<result property="bundlDlvCd" column="BUNDL_DLV_CD"/>
		<result property="bundlPrdGbnCd" column="BUNDL_PRD_GBN_CD"/>
		<result property="bundlPrdGbnFlg" column="BUNDL_PRD_GBN_FLG"/>
		<result property="cardUseLimitFlg" column="CARD_USE_LIMIT_FLG"/>
		<result property="chrDlvFlg" column="CHR_DLV_FLG"/>
		<result property="chrDlvAddFlg" column="CHR_DLV_ADD_FLG"/>
		<result property="chrDlvFlg" column="CHR_DLV_FLG"/>
		<result property="dlvPickMthodCd" column="DLV_PICK_MTHOD_CD"/>
		<result property="dlvcCd" column="DLVC_CD"/>
		<result property="dlvcLimitAmt" column="DLVC_LIMIT_AMT"/>
		<result property="ecAttrPrdCd" column="EC_ATTR_PRD_CD"/>
		<result property="ecAttrSeq" column="EC_ATTR_SEQ"/>
		<result property="ecOrdItemNo" column="EC_ORD_ITEM_NO"/>
		<result property="ecOrdItemSeq" column="EC_ORD_ITEM_SEQ"/>
		<result property="ecOrdNo" column="EC_ORD_NO"/>
		<result property="supOrdNo" column="SUP_ORD_NO"/>
		<result property="exchRtpChrFlg" column="EXCH_RTP_CHR_FLG"/>
		<result property="exposPrdNm" column="EXPOS_PRD_NM"/>
		<result property="frmlesPrdTypCd" column="FRMLES_PRD_TYP_CD"/>
		<result property="gftTypCd" column="GFT_TYP_CD"/>
		<result property="gsnpntNoGivFlg" column="GSNPNT_NO_GIV_FLG"/>
		<result property="immAccmDcLimitFlg" column="IMM_ACCM_DC_LIMIT_FLG"/>
		<result property="instlDlvPrdFlg" column="INSTL_DLV_PRD_FLG"/>
		<result property="prdPrc" column="PRD_PRC"/>
		<result property="mimTypCd" column="MIM_TYP_CD"/>
		<result property="multiSimplGbnCd" column="MULTI_SIMPL_GBN_CD"/>
		<result property="noBkbDpoPsblFlg" column="NO_BKB_DPO_PSBL_FLG"/>
		<result property="oboxCd" column="OBOX_CD"/>
		<result property="onairPrdFlg" column="ONAIR_PRD_FLG"/>
		<result property="onairSalePsblFlg" column="ONAIR_SALE_PSBL_FLG"/>
		<result property="openAftRtpNoadmtFlg" column="OPEN_AFT_RTP_NOADMT_FLG"/>
		<result property="optPrdTypCd" column="OPT_PRD_TYP_CD"/>
		<result property="ordLimitQty" column="ORD_LIMIT_QTY"/>
		<result property="ordMnfcCntnt" column="ORD_MNFC_CNTNT"/>
		<result property="ordMnfcTypCd" column="ORD_MNFC_TYP_CD"/>
		<result property="ordMnfcFlg" column="ORD_MNFC_FLG"/>
		<result property="ordQty" column="ORD_QTY"/>
		<result property="orgFrmlesPrdTypCd" column="ORG_FRMLES_PRD_TYP_CD"/>
		<result property="orgEcOrdItemNo" column="ORG_EC_ORD_ITEM_NO"/>
		<result property="pleinIntrnatTrptFee" column="PLEIN_INTRNAT_TRPT_FEE"/>
		<result property="pleinSetPrdAttrPrdCd1" column="PLEIN_SET_PRD_ATTR_PRD_CD_1"/>
		<result property="pleinSetPrdAttrPrdCd2" column="PLEIN_SET_PRD_ATTR_PRD_CD_2"/>
		<result property="pmoNo" column="PMO_NO"/>
		<result property="sgpayDcFlg" column="SGPAY_DC_FLG"/>
		<result property="prdCd" column="PRD_CD"/>
		<result property="prdClsCd" column="PRD_CLS_CD"/>
		<result property="cpnMaxDcAmt" column="CPN_MAX_DC_AMT"/>
		<result property="genrlCpnNo" column="GENRL_CPN_NO"/>
		<result property="dblCpnNo" column="DBL_CPN_NO"/>
		<result property="prdDcStrin" column="PRD_DC_STRIN"/>
		<result property="prdGbnCd" column="PRD_GBN_CD"/>
		<result property="prdNm" column="PRD_NM"/>
		<result property="prdNoIntInsmMm" column="PRD_NO_INT_INSM_MM"/>
		<result property="prdPmoSeq" column="PRD_PMO_SEQ"/>
		<result property="prdRelspAddrCd" column="PRD_RELSP_ADDR_CD"/>
		<result property="prdTypCd" column="PRD_TYP_CD"/>
		<result property="salePrc" column="SALE_PRC"/>
		<result property="regDtm" column="ORD_ITEM_REG_DTM"/>
		<result property="repPrdSupAddCntnt" column="REP_PRD_SUP_ADD_CNTNT"/>
		<result property="repPrdSupPrdCd" column="REP_PRD_SUP_PRD_CD"/>
		<result property="repPrdSupPrdNm" column="REP_PRD_SUP_PRD_NM"/>
		<result property="repPrdFlg" column="REP_PRD_FLG"/>
		<result property="rfnTypCd" column="RFN_TYP_CD"/>
		<result property="dlvcAmt" column="DLVC_AMT"/>
		<result property="prdFlg" column="PRD_FLG"/>
		<result property="savpntPayFlg" column="SAVPNT_PAY_FLG"/>
		<result property="simplTaxrFlg" column="SIMPL_TAXR_FLG"/>
		<result property="charCpnTypOrdLimitQty" column="CHAR_CPN_TYP_ORD_LIMIT_QTY"/>
		<result property="subSupCd" column="SUB_SUP_CD"/>
		<result property="supAccAmt" column="SUP_ACC_AMT"/>
		<result property="supCd" column="SUP_CD"/>
		<result property="supCompDcAmt" column="SUP_COMP_DC_AMT"/>
		<result property="supOrdLimitQty" column="SUP_ORD_LIMIT_QTY"/>
		<result property="supPrdCd" column="SUP_PRD_CD"/>
		<result property="supPrdPrc" column="SUP_PRD_PRC"/>
		<result property="prdTempoutFlg" column="PRD_TEMPOUT_FLG"/>
		<result property="trvlmPayNo" column="TRVLM_PAY_NO"/>
		<result property="foryyDcLimitPrdFlg" column="FORYY_DC_LIMIT_PRD_FLG"/>
		<result property="zrwonSaleFlg" column="ZRWON_SALE_FLG"/>
	</resultMap>
	<select id="findOrdShtOrgPrdItemList" parameterType="criteria"  resultMap="ordShtOrgPrdItemList">
		<![CDATA[
			SELECT       GOID.EC_ORD_NO                     	/* EC주문번호 */
					    ,GOID.ORG_ORD_EC_ITEM_NO AS ORG_EC_ORD_ITEM_NO           /* EC원주문아이템번호*/
					    ,GOID.EC_ORD_ITEM_NO               /* EC주문아이템번호 */
					    ,GOID.EC_ORD_ITEM_SEQ              /* EC주문아이템순번 */
					    ,GOID.ORD_QTY                          /* 주문수량 */
					    ,NVL(PPM.ORD_LIMIT_QTY, 0) AS ORD_LIMIT_QTY       /* 주문제한수량 */
					    ,GOID.BASKT_GBN_VAL                 	/* 장바구니구분코드 */
					    ,GOID.BASKT_ITEM_NO AS BASKT_ITEM_ID                	/* 장바구니아이템번호 */
					    ,GOID.PRD_CD                           	/* 상품코드 */
					    ,GOID.ATTR_PRD_CD                    	/* 속성상품코드 */
					    ,GOID.EC_ATTR_PRD_CD               	/* EC속성상품코드 */
					    ,GOID.MULTI_SIMPL_GBN_CD       	/* 멀티구분코드 */
					    ,NVL(GOID.SUP_PRD_PRC, 0) AS SUP_PRD_PRC        	/* 협력사상품가격 */
					    ,GOID.SUP_ACC_AMT                                 			/* 협력사적립금액 */
					    ,GOID.SUP_LIMIT_ORD_QTY AS SUP_ORD_LIMIT_QTY                                	/* 협력사주문제한수량 */
					    ,CASE WHEN PPM.DLV_PICK_MTHOD_CD IS NOT NULL AND SUBSTR(PPM.DLV_PICK_MTHOD_CD,0,1) = 3 THEN NVL(PPM.BUNDL_DLV_CD, 'A01')
					        ELSE 'A02'
					    END AS BUNDL_DLV_CD        /* 묶음배송코드 */
					    ,CASE WHEN (GOID.REP_PRD_SUP_PRD_CD IS NOT NULL OR NVL(GOID.PRD_GBN_CD, '') = '70') AND GOID.SUP_PRD_PRC > 0 THEN GOID.SUP_PRD_PRC
					        ELSE PG_PMO_PRD_PMO.FN_ATTR_PRD_MD_DC_PRC(GOID.EC_ATTR_PRD_CD, #{_c.chanlCd[0].value}, SYSDATE)
					    END AS SALE_PRC                                                     /* MD할인(ARS 할인포함) 상품가격 */
					    ,CASE WHEN (NVL(GOID.MULTI_SIMPL_GBN_CD, 'N') = 'N' OR GOID.MULTI_SIMPL_GBN_CD = '') THEN PG_PMO_PRD_PMO.FN_PRD_DC_PMO(GOID.PRD_CD, #{_c.chanlCd[0].value}, SYSDATE, 'N')
					          ELSE '0,0,0'
					    END AS PRD_DC_STRIN                                                       /* 할인금액문자열 */
					    ,CASE WHEN PPM.PRD_RELSP_ADDR_CD IS NULL THEN
					        ( SELECT NVL(SAD.SUP_ADDR_CD, '00') AS ADDR_CD    
					              FROM SUP_ADDR_D SAD
					             WHERE PPM.SUP_CD = SAD.SUP_CD
					                 AND SAD.USE_YN = 'Y'
					                 AND SAD.BASE_RELSP_YN = 'Y'
					                 AND ROWNUM = 1 )
					        ELSE PPM.PRD_RELSP_ADDR_CD
					    END AS PRD_RELSP_ADDR_CD       /*상품출고지주소코드 */
					    ,GOID.OBOX_CD                                              /* 합포장여부*/
					    ,GOID.PRD_CPN_NO AS GENRL_CPN_NO                                           /* 상품쿠폰번호*/
					    ,GOID.PRD_DBL_CPN_NO AS DBL_CPN_NO                                       /* 더블상품쿠폰번호*/
					    ,GOID.OPT_PRD_TYP_CD                                       /* 옵션상품유형코드 */
					    ,GOID.EC_ATTR_SEQ                                          /* EC속성순번 */
					    ,GOID.PRD_GBN_CD AS PRD_GBN_CD                                             /* 상품구분코드   */
					    ,GOID.REP_PRD_SUP_ADD_CNTNT                                /* 업체추가정보 */
					    ,GOID.PLEIN_SET_PRD_ATTR_PRD_CD_1                         /* PLEIN세트상품속성상품코드1 */
					    ,GOID.PLEIN_SET_PRD_ATTR_PRD_CD_2                         /* PLEIN세트상품속성상품코드2 */
					    ,GOID.PMO_NO                                                         /* 프로모션번호 */
					    ,GOID.PRD_PMO_SEQ                                                 /* 상품프로모션번호 */
					    ,NVL(GOID.TRVLM_PAY_NO, 0) AS TRVLM_PAY_NO         /* 여행예약번호 */
					    ,NVL(GOID.CHR_DLV_YN, 'N') AS CHR_DLV_FLG               /* 유료배송여부 */
					    ,GOID.DLVC_CD AS DLVC_CD                                                   /*배송비코드*/        
					    ,GOID.DLVC_STD_AMT AS DLVC_LIMIT_AMT                                               /*배송비기준금액*/
					    ,GOID.RTP_DLVC_IMPOSE_AMT AS DLVC_AMT                                   /*배송비부과여부*/
					    ,NVL(PPM.CHR_DLV_ADD_YN, 'N') AS CHR_DLV_ADD_FLG         /* 유료배송추가여부 */  
					    ,PPM.SUP_CD                                                                /* 협력사코드 */
					    ,NVL(PPM.SUB_SUP_CD, PPM.SUP_CD) AS SUB_SUP_CD          /* 하위협력사코드 */
					    ,DECODE(PPM.FRMLES_PRD_TYP_CD,'E','Y','I','Y','M','Y','T','Y','Y','Y','N') AS FRMLES_PRD_TYP_CD  /* 무형상품코드 */
					    ,NVL(PPM.FRMLES_PRD_TYP_CD,'N') AS ORG_FRMLES_PRD_TYP_CD    /* 원무형상품코드 */
					    ,PPM.ZRWON_SALE_YN  AS ZRWON_SALE_FLG                                                 /* 0원 상품여부 */
					    ,NVL(GOIPD_A04.ADJST_DTL_REP_VAL,'') AS SGPAY_DC_FLG           /* 일시불할인여부 */
					    /* 즉시적립금 영역을 위해 필요한 것 */
					    ,CASE WHEN NVL(PPM.REP_PRD_YN, ' ') <> ' ' OR NVL(PPM.PRD_GBN_CD, '') IN ('10', '20') THEN SSM.MIM_TYP_CD
					        ELSE ''
					    END MIM_CODE            /* 몰인몰유형코드 */
					    ,NVL(PPM.IMM_ACCM_DC_LIMIT_YN,'N') AS IMM_ACCM_DC_LIMIT_FLG
					    ,NVL(GOID.GSNPNT_NO_GIV_YN, 'N') GSNPNT_NO_GIV_FLG          /* GSNPOINT미부여여부 */
					    ,GOID.REP_PRD_SUP_PRD_CD                               	/* 대표상품협력사상품코드 */
					    ,GOID.REP_PRD_SUP_PRD_NM                                 	/* 대표상품협력사상품명 */
					    ,GOID.PRD_NO_INT_INSM_MM                                	/* 상품무이자할부개월 */
					    ,PNCH.EXPOS_PRD_NM                                       	/* EC상품노출명 */   
					    ,NVL( (SELECT 'Y'     
					           FROM LGEC_PGM AA,    
					                LGEC_PGM_DTL BB    
					          WHERE BB.GOODS_CODE = PPM.PRD_CD     
					            AND AA.BROAD_DATE = BB.BROAD_DATE     
					            AND AA.BROAD_DATE <= SYSDATE + 30/1440     
					            AND AA.CLOSING_DATE >= SYSDATE - 30/1440     
					            AND ROWNUM <= 1
					    ), 'N') AS ONAIR_PRD_FLG
					    /* 연간할인권 */
					    ,DECODE((SELECT PRD_CD FROM PRD_UDA_D WHERE UDA_GBN_CD = '10' AND UDA_NO = 22
									AND SYSDATE BETWEEN VALID_STR_DTM AND VALID_END_DTM
									AND USE_YN = 'Y'  and rownum =1
									 AND PRD_CD =GOID.PRD_CD),GOID.PRD_CD,'N','Y') AS FORYY_DC_LIMIT_PRD_FLG  /* 연간할인권 가능여부 */
					    ,NVL(PPM.CARD_USE_LIMIT_YN, 'N') AS CARD_USE_LIMIT_FLG        /* 카드사용제한여부 */
					    ,NVL(PPM.PRD_CLS_CD, '@@@@@@@@') AS PRD_CLS_CD        /**/
					    /* 결제정보 */
					    ,SSM.NO_BKB_DPO_PSBL_YN AS NO_BKB_DPO_PSBL_FLG                  /* 무통장입금가능여부 */
					    ,SSM.SIMPL_TAXR_YN AS SIMPL_TAXR_FLG                          /* 간이과세여부 */
					    ,PPM.DLV_PICK_MTHOD_CD                    /*배송수거방법코드*/
					    ,NVL(PPM.OPEN_AFT_RTP_NOADMT_YN, 'N') AS OPEN_AFT_RTP_NOADMT_FLG   /* 개봉후반품불가여부 */
					    ,NVL(PPM.INSTL_DLV_PRD_YN, 'N') AS INSTL_DLV_PRD_FLG                             /* 설치배송상품여부 */
					    ,PPM.PRD_NM AS PRD_NM                   /* 상품명 */
					    /* 합포장할인 */
					    ,FN_PRD_SALE_PRC(GOID.PRD_CD, SYSDATE) AS PRD_PRC        /* EC 상품판매가 */
					    ,CASE WHEN PPM.BUNDL_PRD_GBN_CD IS NOT NULL THEN 'Y' ELSE '' END AS BUNDL_PRD_GBN_FLG        /* 묶음상품코드 존재여부 */
					    ,NVL(PPM.BUNDL_PRD_GBN_CD, '') AS BUNDL_PRD_GBN_CD                                                                  /* 묶음상품구분코드 */
					    ,GOID.PRD_CPN_MAX_DC_AMT AS CPN_MAX_DC_AMT    /* 쿠폰정보 */
					    ,PPM.PRD_TYP_CD       /* 상품유형코드 */
					    ,NVL(PPM.ORD_MNFC_YN, 'N') AS ORD_MNFC_FLG             /* 주문제작상품여부 */
					    ,CASE WHEN PPM.ORD_MNFC_YN = 'Y' THEN PPM.ORD_MNFC_TYP_CD ELSE '' END AS ORD_MNFC_TYP_CD        /* [주문제작]주문제작유형(10:맞춤제작,20:주문후제작,30:주문후수입) */
					    ,PPM.ORD_MNFC_CNTNT                                               /* 주문제작맟춤내용 */
					    ,CASE WHEN PPM.PRD_TYP_CD = 'S' THEN PAPM.ATTR_VAL_1 ELSE '' END AS PRD_ATTR_COLOR    /* 컬러속성값 */
					    ,CASE WHEN PPM.PRD_TYP_CD = 'S' THEN PAPM.ATTR_VAL_2 ELSE '' END AS PRD_ATTR_SIZE    /* 사이즈속성값 */
					    ,CASE WHEN PPM.PRD_TYP_CD = 'S' THEN PAPM.ATTR_VAL_3 ELSE '' END AS PRD_ATTR_STYLE    /* 스타일속성값 */
					    ,CASE WHEN PPM.PRD_TYP_CD = 'S' THEN PAPM.ATTR_VAL_4 ELSE '' END AS PRD_ATTR_GFT    /* 사은품속성값 */
					    ,CASE WHEN PPM.SALE_END_DTM < SYSDATE THEN 'Y' 
					        WHEN NVL(PAPM.SALE_END_DTM, SYSDATE+1) < SYSDATE THEN 'Y'
					        ELSE 'N' 
					    END AS PRD_FLG            /* 품절여부 */
					    ,CASE WHEN PPM.TEMPOUT_YN = 'Y' OR PSD.TEMPOUT_YN = 'Y' 
					        THEN 'Y'
					        ELSE 'N'
					    END  AS PRD_TEMPOUT_FLG,            /* 일시품절여부 */
					    CASE WHEN GOID.PRD_GBN_CD = '70' AND NVL(GOID.RTP_DLVC_IMPOSE_AMT, 0) > 0 
					        THEN 'Y'
					        ELSE NVL(GOID.CHR_DLV_YN, 'N')
					    END AS CHR_DLV_FLG                /* 배송비부과여부 */
					    ,PMD.ATTR_CHAR_VAL_1 AS CHAR_CPN_GBN_VAL                /* 상품메타속성문자값1 */
					    ,PMD.ATTR_CHAR_VAL_2 AS CHAR_CPN_TYP_VAL				  /* 상품메타속성문자값2([문자쿠폰]문자종류 ('MMS', 'SMS'))*/
					    ,TO_NUMBER(NVL((SELECT VAL FROM EC_REFSETVAL WHERE REFSETID = 5417 AND CODE = PMD.ATTR_CHAR_VAL_2), 0)) AS CHAR_CPN_TYP_ORD_LIMIT_QTY      /* [문자쿠폰]문자종류 ('MMS:5', 'SMS:1') 수량 */
					    ,NVL(PPM.ONAIR_SALE_PSBL_YN, 'N') AS ONAIR_SALE_PSBL_FLG /* 생방송외판매불가여부*/
					    ,PPM.REP_PRD_YN AS REP_PRD_FLG		/* 대표상품여부 */
					    ,NVL(SSM.SAVPNT_PAY_YN, 'N') AS SAVPNT_PAY_FLG    /* (현대)세이브포인트결제여부 */
					    ,GOID.REG_DTM AS ORD_ITEM_REG_DTM	/**** 주문생성시 사용할 파라미터 **/ 
					    ,GOID.PLEIN_INTRNAT_TRPT_FEE
					    ,GOID.EC_SUP_ORD_CD AS SUP_ORD_NO
					    ,GOID.BROAD_PRE_ORD_BROAD_ID
					    ,GOID.BROAD_PRE_ORD_PATH_NM
					    ,GOID.ATTR_REP_PRD_CD AS ATTR_PRD_REP_CD
					    ,PPM.RFN_TYP_CD
					    ,PPM.ARFN_TIME_CD
					    ,PPM.EXCH_RTP_CHR_YN AS EXCH_RTP_CHR_FLG
					    ,PPM.GFT_TYP_CD AS PRD_GFT_TYP_CD
					    ,NVL(GOIPD_A09.SUP_GIV_AMT,0) AS SUP_COMP_DC_AMT           /* 구성품 할인액 */
					    ,PPM.SUP_PRD_CD      /* 협력사상품코드 */
					FROM  
					    GS_ORD_M GOM
					    ,GS_ORD_ITEM_D GOID
					    ,PRD_PRD_M PPM
					    ,SUP_SUP_M SSM
					    ,PRD_ATTR_PRD_M PAPM
					    ,PRD_META_D PMD
					    ,PRD_STOCK_D PSD
					    ,PRD_NM_CHG_H PNCH
					    ,GS_ORD_ITEM_PRC_D GOIPD_A04
					    ,GS_ORD_ITEM_PRC_D GOIPD_A09
					WHERE  
					    GOM.EC_ORD_NO = #{_c.ecOrdNo[0].value}
					    AND GOM.EC_CUST_NO = #{_c.ecCustNo[0].value}
					    AND GOM.EC_ORD_NO = GOID.EC_ORD_NO
					    AND GOM.EC_ORD_ST_CD = 'A'    
					    AND GOID.EC_ORD_ST_CD = 'A'
					    AND GOID.PRD_CD = PPM.PRD_CD
					    AND GOID.MULTI_SIMPL_GBN_CD IS NULL
					    AND PPM.USE_YN = 'Y'
					    AND PPM.SALE_END_DTM > SYSDATE
					    AND NVL(PPM.PRD_GBN_CD, 'A') <> 'R'                                /*상품구분코드*/    
					    AND NVL(PPM.GFT_TYP_CD, '00') NOT IN ('03','04','07','08')    /*사은품유형코드 경품이 아닌 상품만*/
					    AND GOID.EC_ATTR_PRD_CD = PAPM.EC_ATTR_PRD_CD
					    AND GOID.PRD_CD = PNCH.PRD_CD
					    AND PNCH.CHANL_CD = #{_c.chanlCd[0].value}
					    AND SYSDATE BETWEEN PNCH.VALID_STR_DTM AND PNCH.VALID_END_DTM
					    AND PPM.SUP_CD = SSM.SUP_CD(+)                      /*업체코드*/
					    AND GOID.EC_ORD_ITEM_NO = GOIPD_A04.EC_ORD_ITEM_NO(+)
					    AND GOIPD_A04.ADJST_DTL_CD(+) = 'A04'         /* 일시불할인 */
					    AND GOIPD_A04.EC_ORD_ST_CD(+) = 'A'
					    AND GOIPD_A04.PRE_CALC_YN(+) = 'Y'         /* 미리계산여부 */
					    AND GOID.EC_ORD_ITEM_NO = GOIPD_A09.EC_ORD_ITEM_NO(+)
					    AND GOIPD_A09.ADJST_DTL_CD(+) = 'A09'         /* 구성품할인액 */
					    AND GOIPD_A09.EC_ORD_ST_CD(+) = 'A'
					    AND GOIPD_A09.PRE_CALC_YN(+) = 'Y'         /* 미리계산여부 */
					    AND PAPM.ATTR_PRD_REP_CD = PSD.ATTR_PRD_REP_CD
					    AND PAPM.PRD_CD = PMD.PRD_CD(+)
					    AND PMD.PRD_META_TYP_CD(+) = '30'
		   ]]>    
	</select>
	
	<!-- 
		내용	: 임직원(그룹사) 할인 적용된 가격 조회.(procedure)
		작성자	: 윤병찬
		작성일	: 2013.10.29 신규작성
	-->

	<select id="findInsaleDcAmt" statementType="CALLABLE" parameterType="hashmap">
		{  call SP_PMO_EMP_DC(
		   		  #{an_catvid}                   /* 고객번호 */
			    , #{av_cus_class}                /* 고객구분 */
			    , #{an_staff_limit}              /* 사내판매 한도액 */
			    , #{an_prdid}                    /* 상품번호 */
			    , #{an_prd_price}                /* 상품가격(MD프로모션적용가) -> 원 상품가격으로 변경 */
			    , #{an_discount_price}           /* 일시불할인가격 */
			    , #{av_computer}                 /* PC할인가 적용여부(고객선택) : 고객할인 선택시 0값, Y/N */
			    , #{av_discount_flag}            /* 일시불할인 적용여부('Y':고객선택 /'N':고객미선택 /'C':일시불할인 않되는 상품) */
			    , #{av_muija}                    /* 무이자개월수 */
			    , #{av_coupon_num}               /* 쿠폰번호 */
			    , #{an_dc_rate, mode=OUT, javaType=DECIMAL, jdbcType=DECIMAL}        /* 패밀리할인 적용 % */
			    , #{an_dc_type, mode=OUT, javaType=String, jdbcType=VARCHAR}        /* 할인율적용 구분 '1':일반 '2':사내 '3':패밀리 */
			    , #{an_interest_rate, mode=OUT, javaType=DECIMAL, jdbcType=DECIMAL}  /* 추가할인율(일시불할인 대상 상품의 일시불 결제시(단, 프로모션에서 할인금액이 없슴.) */
			    , #{an_sale_price, mode=OUT, javaType=DECIMAL, jdbcType=DECIMAL}     /* 패밀리할인 적용 금액 */
			    , #{an_interest_price, mode=OUT, javaType=DECIMAL, jdbcType=DECIMAL} /* 패밀리할인 + 추가할인 적용 금액 */
			    , #{an_is_com, mode=OUT, javaType=String, jdbcType=VARCHAR}         /* 컴퓨터여부 */
			    , #{an_free_gift_amt, mode=OUT, javaType=DECIMAL, jdbcType=DECIMAL}  /* 사은품의 업체지급액합계 */
		   )
		}        
	</select>
	
	
	
	<!-- 
		내용	: 제휴 임직원  할인 적용된 가격 조회.(procedure)
		작성자	: 윤병찬
		작성일	: 2013.10.29 신규작성
	-->

	<select id="findAliaDcAmt" statementType="CALLABLE" parameterType="hashmap">
		{  call SP_PMO_ALIA_DC(
		   		  #{an_catvid}                   /* 고객번호 */
			    , #{av_cus_class}                /* 고객구분 */
			    , #{an_prdid}              /* 상품번호 */
			    , #{an_prd_price}                    /* 상품가격(MD프로모션적용가) */
			    , #{av_media_type}                /* 매체코드 */
			    , #{an_discount_price}           /* 일시불할인가격 */
			    , #{av_discount_flag}                 /* 일시불할인 적용여부('Y':고객선택 /'N':고객미선택 /'C':일시불할인 않되는 상품) */
			    , #{an_dc_rate, mode=OUT, javaType=DECIMAL, jdbcType=DECIMAL}        /* 제휴할인 적용 % */
			    , #{av_dc_type, mode=OUT, javaType=String, jdbcType=VARCHAR}        /* 할인율적용 구분 '1':일반 '3':제휴할인 */
			    , #{an_sale_price, mode=OUT, javaType=DECIMAL, jdbcType=DECIMAL}  /* 제휴사할인 적용 금액 */
		   )
		}        
	</select>	
	
	
	
	
	
	
	
	<!-- 
		내용	: 임직원/제휴임직원/그룹사임직원 일시불금액 조회(주문서에서 사용)
		작성자	: 윤병찬
		작성일	: 2013.10.29 신규작성
		
		 #{_c.prdCd[0].value} = 11742229
		 #{_c.insaleDcAmt[0].value} = 10
		
	-->
	<select id="findPrdFamilyDcPmoNoPay" parameterType="criteria"  resultType="String">
		SELECT PG_PMO_PRD_PMO.FN_PRD_FAMILY_DC_PMO(#{_c.prdCd[0].value}, 'P', SYSDATE, 'N', #{_c.insaleDcAmt[0].value}) AS EMP_SGPAY_DC_AMT
		  FROM DUAL
	</select>
	
	
	
	<!-- 
		내용	: 해당 상품의 적립금액 조회
		작성자	: 윤병찬
		작성일	: 2013.10.29 신규작성
		
		#{_c.prdCd[0].value} =  11742229;
		#{_c.prdSalePrc[0].value} = 10000; //판매가
		
	-->
	<select id="findJuklibOnlyPromotion" parameterType="criteria"  resultType="long">
		SELECT PG_PMO_PRD_PMO.FN_PRD_ACCM(#{_c.prdCd[0].value}, 'P', SYSDATE, #{_c.prdSalePrc[0].value}) AS ACC_AMT
		  FROM DUAL
	</select>
	

	<!-- 
		내용	: 아이템 테이블에 담겨있는 상품군별 주문수량을 조회
		작성자	: 윤병찬
		작성일	: 2013.10.29 신규작성
		
		#{ecOrdNo} = 46;
		#{ecOrdItemNo} = 0;
		#{prdCd} = 6060437;
		
	-->
	<resultMap id="gsOrdItemDForPrdOrdQtyMap" type="iceberg.capi.order.model.ordersheet.GsOrdItemDExt">
		<result property="prdCd" column="PRD_CD"/>
		<result property="prdNm" column="PRD_NM"/>
		<result property="exposPrdNm" column="EXPOS_PRD_NM"/>
		<result property="ordQty" column="ORD_QTY"/>
		<result property="onePrsnPrchLimitDdcnt" column="ONE_PRSN_PRCH_LIMIT_DDCNT"/>
		<result property="onePrsnPrchLimitQty" column="ONE_PRSN_PRCH_LIMIT_QTY"/>
		<result property="onePrsnValidEndDtm" column="ONE_PRSN_VALID_END_DTM"/>
		<result property="onePrsnValidStrDtm" column="ONE_PRSN_VALID_STR_DTM"/>
	</resultMap>
	<select id="findGsOrdItemDForPrdOrdQty" parameterType="iceberg.capi.order.model.ordersheet.GsOrdItemD"  resultMap="gsOrdItemDForPrdOrdQtyMap">
			SELECT PPM.PRD_CD AS PRD_CD ,
			       PPM.PRD_NM AS PRD_NM ,
			       PNCH.EXPOS_PRD_NM AS EXPOS_PRD_NM,
			       SUM(GOID.ORD_QTY) AS ORD_QTY ,
			       TO_NUMBER(MAX(NVL(PRDUDA.UDA_VAL_1, 0))) AS ONE_PRSN_PRCH_LIMIT_DDCNT ,
			       TO_NUMBER(MAX(NVL(PRDUDA.UDA_VAL, 0))) AS ONE_PRSN_PRCH_LIMIT_QTY ,
			       TO_CHAR(MAX(PRDUDA.VALID_STR_DTM), 'YYYY-MM-DD HH24:MI:SS') AS ONE_PRSN_VALID_STR_DTM ,
			       TO_CHAR(MAX(PRDUDA.VALID_END_DTM), 'YYYY-MM-DD HH24:MI:SS') AS ONE_PRSN_VALID_END_DTM
			FROM   GS_ORD_ITEM_D GOID ,
			       PRD_PRD_M PPM ,
			       PRD_ATTR_PRD_M PAPM ,
			       PRD_UDA_D PRDUDA,
			       PRD_NM_CHG_H PNCH
			WHERE  GOID.EC_ORD_NO = #{ecOrdNo}
			AND GOID.EC_ORD_ITEM_NO <![CDATA[ <> ]]> #{ecOrdItemNo}
			   <if test='prdCd > 0'>
			AND GOID.PRD_CD = #{prdCd} 
			   </if>
<![CDATA[			   
			AND    GOID.EC_ORD_ST_CD = 'A'
			AND    GOID.EC_ATTR_PRD_CD = PAPM.EC_ATTR_PRD_CD
			AND    PAPM.PRD_CD = PPM.PRD_CD
			AND    PPM.USE_YN = 'Y'
			AND    NVL(PPM.PRD_GBN_CD, 'A') <> 'R'
			AND    NVL(PAPM.SALE_STR_DTM, SYSDATE - 1) < SYSDATE
			AND    PRDUDA.PRD_CD(+) = PPM.PRD_CD
			AND    PRDUDA.UDA_GBN_CD(+) = '10'
			AND    PRDUDA.UDA_NO(+) = 15
			AND    PRDUDA.USE_YN(+) = 'Y'
			AND    SYSDATE BETWEEN PRDUDA.VALID_STR_DTM(+) AND PRDUDA.VALID_END_DTM(+)
			AND    PPM.PRD_CD = PNCH.PRD_CD
			AND    SYSDATE BETWEEN PNCH.VALID_STR_DTM AND PNCH.VALID_END_DTM
			GROUP BY PPM.PRD_CD, PPM.PRD_NM, PNCH.EXPOS_PRD_NM
]]> 			
	</select>	
	
	<!-- 
		내용	: 고객등급에 해당되는 문구 가져오기
		작성자	: 윤병찬
		작성일	: 2013.10.29 신규작성
		
		#{custClsCd} = '02'; //02 : GS홈쇼핑 임직원
		주의. 이 쿼리는 PO통해서 현업에 사용유무를 확인중인 업무여서 AS-IS 그대로 구현함. (윤병찬)
		
	-->
	<select id="findLgecBk013CopyInfo" parameterType="String"  resultType="iceberg.capi.order.model.common.LgecBk013Copy">
		<![CDATA[
		SELECT CUS_CLASS    
		      ,MEDIA_TYPE  
		 	  ,MEDIA_COPY01 
		      ,MEDIA_COPY02 
		      ,MEDIA_COPY03 
		      ,MEDIA_COPY04 
		      ,MEDIA_COPY05 
		      ,MEDIA_COPY06 
		      ,MEDIA_COPY07 
		      ,MEDIA_COPY08 
		      ,MEDIA_COPY09 
		      ,MEDIA_COPY10 
		      ,MEDIA_COPY11 
		      ,MEDIA_COPY12 
		      ,MEDIA_COPY13 
		      ,MEDIA_COPY14 
		      ,MEDIA_COPY15 
		      ,MEDIA_COPY16 
		      ,MEDIA_COPY17 
		      ,MEDIA_COPY18 
		      ,MEDIA_COPY19 
		      ,MEDIA_COPY20 
		      ,MEDIA_COPY21
		 FROM LGEC_BK013_COPY 
		 WHERE CUS_CLASS = #{custClsCd}
		   AND ROWNUM < 2
		 ]]>  
	</select>
	
	
	<!-- 
		내용	: GS_ORD_M 테이블 주문유형 수정 
		작성자	: 윤병찬
		작성일	: 2013.10.29 신규작성
		
		#{ecOrdNo} = 280;  
		#{chanlDtlCd} = 'PA';  //MC간편주문 결제
		
	-->
	<update id="updateOrdShtTypCd" parameterType="iceberg.capi.order.model.ordersheet.GsOrdM">
		UPDATE GS_ORD_M
		   SET 
		   <if test="ordshtTypCd != null">
		       ORDSHT_TYP_CD = #{ordshtTypCd}
		   </if>    
		   <if test="ordModDtm != null">	
		      ,MOD_DTM = #{ordModDtm}
		   </if>   
		   <if test="ordModrId != null">	   
		      ,MODR_ID = #{ordModrId}
		   </if>   
		   <if test="empOrdTypCd != null">	   
		      ,FMLY_ORD_TYP_CD = #{empOrdTypCd}
		   </if>   
		   <if test="empOrdDcRt != null">	   
		      ,FMLY_ORD_DC_RT = #{empOrdDcRt}
		   </if>   
		   <if test="chanlDtlCd != null">	   
		      ,CHANL_DTL_CD = #{chanlDtlCd}
		   </if>   
			WHERE EC_ORD_NO = #{ecOrdNo}
	</update>		
	
    <!-- 
		내용	: 사은품 정보 조회
		작성자	: 윤병찬
		작성일	: 2013.10.29 신규작성
		
		#{_c.ecOrdNo[0].value} = 563;
		#{_c.ecCustNo[0].value} = 3939326;
		#{_c.ordTypCd[0].value} = 'MOB_ORD';
		
	-->
	<resultMap id="giftMappingItemListMap" type="iceberg.capi.order.model.ordersheet.GsOrdItemGftMapDExt">
		<result property="ecOrdItemNo" column="EC_ORD_ITEM_NO"/>
		<result property="prdCd" column="PRD_CD"/>
		<result property="attrPrdCd" column="ATTR_PRD_CD"/>
		<result property="ecAttrPrdCd" column="EC_ATTR_PRD_CD"/>
		<result property="attrPrdRepCd" column="ATTR_PRD_REP_CD"/>
		<result property="ordQty" column="ORD_QTY"/>
		<result property="exposPrdNm" column="EXPOS_PRD_NM"/>
		<result property="idenNo" column="IDEN_NO"/>
		<result property="orgPrdEcOrdItemNo" column="ORG_PRD_EC_ORD_ITEM_NO"/>
		<result property="tgtGbnCd" column="TGT_GBN_CD"/>
		<result property="pmoNo" column="PMO_NO"/>
		<result property="prdPmoSeq" column="PRD_PMO_SEQ"/>
		<result property="mandFlg" column="MAND_FLG"/>
		<result property="addCmposGbnCd" column="ADD_CMPOS_GBN_CD"/>
		<result property="indiviDlvPmsnFlg" column="INDIVI_DLV_PMSN_FLG"/>
		<result property="wthdrwFlg" column="WTHDRW_FLG"/>
		<result property="rfnTypCd" column="RFN_TYP_CD"/>
		<result property="arfnTimeCd" column="ARFN_TIME_CD"/>
		<result property="exchRtpChrFlg" column="EXCH_RTP_CHR_FLG"/>
		<result property="basktItemId" column="BASKT_ITEM_ID"/>
		<result property="prdTypCd" column="PRD_TYP_CD"/>
	</resultMap>
	<select id="findGiftMappingItemList" parameterType="criteria"  resultMap="giftMappingItemListMap">
		<![CDATA[
		SELECT 	 GOID.EC_ORD_ITEM_NO
			    ,GOID.PRD_CD
			    ,GOID.ATTR_PRD_CD
			    ,GOID.EC_ATTR_PRD_CD
			    ,GOID.ATTR_REP_PRD_CD
			    ,GOID.ORD_QTY
			    ,GOID.EXPOS_PRD_NM
			    ,GOIGMD.IDEN_NO
			    ,GOIGMD.ORGPRD_EC_ORD_ITEM_NO AS ORG_PRD_EC_ORD_ITEM_NO
			    ,PSD.TGT_GBN_CD
			    ,PSGD.PMO_NO
			    ,PSGD.PRD_PMO_SEQ
			    ,PSGD.MAND_YN AS MAND_FLG
			    ,PSGD.ADD_CMPOS_GBN_CD
			    ,PSGD.INDIVI_DLV_PMSN_YN AS INDIVI_DLV_PMSN_FLG
			    ,PSGD.WTHDRW_YN AS WTHDRW_FLG
			    ,PPM.RFN_TYP_CD
			    ,PPM.ARFN_TIME_CD
			    ,PPM.EXCH_RTP_CHR_YN AS EXCH_RTP_CHR_FLG
			    ,GOID.BASKT_ITEM_NO
			    ,PPM.PRD_TYP_CD
			FROM
			     GS_ORD_M GOM
			    ,GS_ORD_ITEM_D GOID
			    ,GS_ORD_ITEM_GFT_MAP_D GOIGMD
			    ,PMO_SIMPL_D PSD
			    ,PMO_SIMPL_GFT_D PSGD
			    ,PRD_PRD_M PPM
			WHERE GOM.EC_ORD_NO = #{_c.ecOrdNo[0].value}
			    AND GOM.EC_CUST_NO = #{_c.ecCustNo[0].value} 
			    AND GOM.ORD_TYP_CD = #{_c.ordTypCd[0].value} 
			    AND GOID.EC_ORD_NO = GOM.EC_ORD_NO
			    AND GOID.MULTI_SIMPL_GBN_CD IS NOT NULL
			    AND GOIGMD.EC_ORD_ITEM_NO = GOID.EC_ORD_ITEM_NO
			    AND GOM.EC_ORD_ST_CD = 'A'
			    AND GOID.EC_ORD_ST_CD = 'A'
			    AND GOIGMD.EC_ORD_ST_CD = 'A'        
			    AND PSGD.PMO_NO = GOID.PMO_NO
			    AND PSGD.PRD_PMO_SEQ = GOID.PRD_PMO_SEQ
			    AND PSGD.GFT_PRD_CD = GOID.PRD_CD
			    AND PSGD.PMO_NO = PSD.PMO_NO
			    AND PSGD.PRD_PMO_SEQ = PSD.PRD_PMO_SEQ
			    AND PSGD.ADD_CMPOS_GBN_CD IN ('G', 'D')
			    AND SYSDATE BETWEEN PSD.VALID_STR_DTM AND PSD.VALID_END_DTM
			    AND GOID.PRD_CD = PPM.PRD_CD
		 ]]>  
	</select>
		
		
	 <!-- 
		내용	: 주문유효성 검증(24시간 이내 주문인지 체크)
		작성자	: 윤병찬
		작성일	: 2013.11.13 신규작성
		
		#{_c.ecOrdNo[0].value} = 563;
		#{_c.ecCustNo[0].value} = 3939326;
		
		주의. AND REG_DTM > SYSDATE-1 조건때문에 데이타 없을수 있음
		
	-->
	<select id="findGsOrdMValidTime" parameterType="criteria"  resultType="int">
		<![CDATA[
			SELECT COUNT(*)
			  FROM GS_ORD_M
			 WHERE EC_ORD_NO = #{_c.ecOrdNo[0].value}
			   AND EC_CUST_NO = #{_c.ecCustNo[0].value}
			   AND EC_ORD_ST_CD = 'A'
			   AND REG_DTM > SYSDATE-1
		 ]]>  
	</select>	
	
	<!-- 
		내용	: 아이템 상세 테이블에서 사은품 정보 삭제 
		작성자	: 윤병찬
		작성일	: 2013.11.18 신규작성
		
		#{ecOrdStCd} = 'D'
		#{modDtm} = '2013-11-19 10:39:02'
		#{modrId} = 9806081
		#{ecOrdItemNo} = 580
	-->
	<update id="updateOrdItemDGftInfo" parameterType="iceberg.capi.order.model.ordersheet.GsOrdItemD">
			UPDATE GS_ORD_ITEM_D
			   SET EC_ORD_ST_CD = #{ecOrdStCd}
			      ,MOD_DTM = #{modDtm}
			      ,MODR_ID = #{modrId}
			 WHERE EC_ORD_ITEM_NO = #{ecOrdItemNo}	
	</update>		
	
	
	<!-- 
		내용	: 사은품 아이템 매핑테이블에서 사은품 삭제
		작성자	: 윤병찬
		작성일	: 2013.11.18 신규작성
		
		#{ecOrdStCd} = 'D'  
		#{modDtm} = '2013-11-19 10:39:02'  
		#{modrId} = 9806081 
		#{idenNo} = 122
	-->
	<update id="updateOrdItemGftMapInfo" parameterType="iceberg.capi.order.model.ordersheet.GsOrdItemGftMapD">
			UPDATE GS_ORD_ITEM_GFT_MAP_D
			   SET EC_ORD_ST_CD = #{ecOrdStCd}
			      ,MOD_DTM = #{modDtm}
			      ,MODR_ID = #{modrId}
			 WHERE IDEN_NO = #{idenNo}	
	</update>		
	
	
	
	 <!-- 
		내용	: 상품UDA정보의 조회수를 리턴 - (GSnPoint 사용 제한 상품 대상 존재 여부를 체크하기 위함.)
		작성자	: 윤병찬
		작성일	: 2013.11.28 신규작성
		
		#{_c.ecOrdNo[0].value} = 21387118;
		#{_c.udaGbnCd[0].value} = '10';
		#{_c.udaNo[0].value} = '21';
		
		주의. AND SYSDATE BETWEEN PUD.VALID_STR_DTM AND PUD.VALID_END_DTM 조건때문에 데이타 없을수 있음
		
	-->
	<select id="findGsOrdItemPrdUdaCnt" parameterType="criteria"  resultType="long">
		<![CDATA[
			 SELECT /*+ ORDERED USE_NL(ITEM, PUD, PUC)*/                                                
			        COUNT(*)                                                                            
			   FROM GS_ORD_ITEM_D GOID                                                                 
			       ,PRD_UDA_D PUD                                                                      
			       ,PRD_UDA_C PUC                                                                       
			  WHERE GOID.EC_ORD_NO = #{_c.ecOrdNo[0].value}                                             
			    AND GOID.EC_ORD_ST_CD = 'A'                                                             
			    AND GOID.PRD_CD = PUD.PRD_CD                                                            
			    AND PUC.UDA_GBN_CD = PUD.UDA_GBN_CD                                                     
			    AND PUC.UDA_NO = PUD.UDA_NO                                                             
			    AND PUC.UDA_GBN_CD = #{_c.udaGbnCd[0].value}                                            
			    AND PUC.UDA_NO = #{_c.udaNo[0].value}                                                   
			    AND PUC.USE_YN = 'Y'                                                                    
			    AND PUD.USE_YN = 'Y'                                                                    
			    AND SYSDATE BETWEEN PUD.VALID_STR_DTM                                                   
			                    AND PUD.VALID_END_DTM   
		 ]]>  
	</select>	



	
	
	<!-- 
		내용	: GS_ORD_M 테이블 주문생성 후 결과 값 수정
		작성자	: 윤병찬
		작성일	: 2013.12.16 신규작성
		
	-->
	 
	<update id="updateOrderCreateResultGsOrdM" parameterType="iceberg.capi.order.model.ordersheet.GsOrdM">
        	UPDATE   GS_ORD_M
     			SET	  EC_ORD_NO = #{ecOrdNo}
		<if test="ordRegDtm != null">
					, REG_DTM = #{ordRegDtm}
		</if>
		<if test="ordRegrId != null">
					, REGR_ID = #{ordRegrId}
		</if>
		<if test="ordModDtm != null">
					, MOD_DTM = #{ordModDtm}
		</if>
		<if test="ordModrId != null">
					, MODR_ID = #{ordModrId}
		</if>
		<if test="ordDtm != null">
					, ORD_DTM = #{ordDtm}
		</if>
		<if test="ordNo != 0">
					, ORD_NO = #{ordNo}
		</if>
		<if test="orgOrdNo != 0">
					, ORG_ORD_NO = #{orgOrdNo}
		</if>
		<if test="chanlCd != null">
					, CHANL_CD = #{chanlCd}
		</if>
		<if test="chanlDtlCd != null">
					, CHANL_DTL_CD = #{chanlDtlCd}
		</if>
		<if test="ecOrdStCd != null">
					, EC_ORD_ST_CD = #{ecOrdStCd}
		</if>
		<if test="basktNo != 0">
					, BASKT_NO = #{basktNo}
		</if>
		<if test="custNo != 0">
					, CUST_NO = #{custNo}
		</if>
		<if test="ecCustNo != 0">
					, EC_CUST_NO = #{ecCustNo}
		</if>
		<if test="custClsCd != null">
					, CUST_CLS_CD = #{custClsCd}
		</if>
		<if test="ecNomemOrdFlg != null">
					, EC_NOMEM_ORD_YN = #{ecNomemOrdFlg}
		</if>
		<if test="ordTypCd != null">
					, ORD_TYP_CD = #{ordTypCd}
		</if>
		<if test="ordshtTypCd != null">
					, ORDSHT_TYP_CD = #{ordshtTypCd}
		</if>
		<if test="ordshtPrdTypCd != null">
					, ORDSHT_PRD_TYP_CD = #{ordshtPrdTypCd}
		</if>
		<if test="preCalcPayTypCd != null">
					, PRE_CALC_PAY_TYP_CD = #{preCalcPayTypCd}
		</if>
		<if test="repPayMeanCd != null">
					, REP_PAY_MEAN_CD = #{repPayMeanCd}
		</if>
		<if test="ecDpoCnfSmsSndFlg != null">
					, EC_DPO_CNF_SMS_SND_YN = #{ecDpoCnfSmsSndFlg}
		</if>
		<if test="dlvcImposeFlg != null">
					, DLVC_IMPOSE_YN = #{dlvcImposeFlg}
		</if>
		<if test="dlvcImposeAmt > -1">
					, DLVC_IMPOSE_AMT = #{dlvcImposeAmt}
		</if>
		<if test="dlvcStdAmt > -1">
					, DLVC_STD_AMT = #{dlvcStdAmt}
		</if>
		<if test="empOrdDcRt != 0">
					, FMLY_ORD_DC_RT = #{empOrdDcRt}
		</if>
		<if test="empOrdTypCd != null">
					, FMLY_ORD_TYP_CD = #{empOrdTypCd}
		</if>
		<if test="fstOrdAmtTot != 0">
					, FST_ORD_AMT_TOT = #{fstOrdAmtTot}
		</if>
		<if test="fstUseAccAmt != 0">
					, FST_USE_ACC_AMT = #{fstUseAccAmt}
		</if>
		<if test="gsnpntMemshpAdmStCd != null">
					, GSNPNT_MEMSHP_ADM_ST_CD = #{gsnpntMemshpAdmStCd}
		</if>
		<if test="cashRcptReqFlg != null">
					, CASH_RCPT_REQ_YN = #{cashRcptReqFlg}
		</if>
		<if test="cashRcptGbnCd != null">
					, CASH_RCPT_GBN_CD = #{cashRcptGbnCd}
		</if>
		<if test="cashRcptIdenNoEcp != null">
					, CASH_RCPT_IDEN_NO_ECP = #{cashRcptIdenNoEcp}
		</if>
		<if test="ordReqPathNm != null">
					, ORD_PATH_NM = #{ordReqPathNm}
		</if>
		<if test="custRegrIp != null">
					, USER_IP = #{custRegrIp}
		</if>
		<if test="wasInstncNm != null">
					, SVR_NM = #{wasInstncNm}
		</if> 
				WHERE EC_ORD_NO = #{ecOrdNo}
	</update>		
	
	
	<!-- 
		내용	: GS_ORD_ITEM_D 테이블을 FLAG UPDATE
		작성자	: 윤병찬
		작성일	: 2013.12.16 신규작성
		
		#{ecOrdNo} = 280;  
		
	-->
	<update id="deleteGsOrdItemD" parameterType="long">
			UPDATE GS_ORD_ITEM_D
			   SET EC_ORD_ST_CD = 'D',
			       MOD_DTM = SYSDATE
			 WHERE EC_ORD_NO = #{ecOrdNo}
			   AND  EC_ORD_ST_CD = 'A'
	</update>		
	
	
	<!-- 
		내용	: GS_ORD_ITEM_D 테이블을 FLAG UPDATE
		작성자	: 윤병찬
		작성일	: 2013.12.16 신규작성
		
		#{_c.ecOrdNo[0].value} = 280;  
		
	-->
	<update id="deleteGsOrdItemPrcD" parameterType="criteria">
			 UPDATE GS_ORD_ITEM_PRC_D
			   SET  EC_ORD_ST_CD = 'D'
			       ,MOD_DTM = SYSDATE
			       ,MODR_ID = #{_c.modrId[0].value}
			 WHERE EC_ORD_ITEM_NO IN (
								         SELECT GOID.EC_ORD_ITEM_NO
								          FROM GS_ORD_M GOM,
								               GS_ORD_ITEM_D GOID
								         WHERE GOM.EC_ORD_NO = #{_c.ecOrdNo[0].value}
								           AND GOM.EC_ORD_NO = GOID.EC_ORD_NO
			      )
			  AND EC_ORD_ST_CD = 'A'
	</update>		
	
	
	<!-- 
		내용	: GS_ORD_ITEM_GFT_MAP_D 테이블을 모든 데이터 FLAG UPDATE
		작성자	: 윤병찬
		작성일	: 2013.12.16 신규작성
		
		#{_c.ecOrdNo[0].value} = 280;  
		
	-->
	<update id="deleteGsOrdItemGftMapD" parameterType="criteria">
			 UPDATE GS_ORD_ITEM_GFT_MAP_D
			   SET EC_ORD_ST_CD = 'D',
			       MOD_DTM = SYSDATE,
			       MODR_ID = #{_c.modrId[0].value}
			 WHERE ORGPRD_EC_ORD_ITEM_NO IN (
										         SELECT GOID.EC_ORD_ITEM_NO
										          FROM GS_ORD_M GOM,
										               GS_ORD_ITEM_D GOID
										         WHERE GOM.EC_ORD_NO = #{_c.ecOrdNo[0].value}
										           AND GOM.EC_ORD_NO = GOID.EC_ORD_NO
			      )
			  AND EC_ORD_ST_CD = 'A'  
	</update>	
	

	
	
	
	
	

</mapper>